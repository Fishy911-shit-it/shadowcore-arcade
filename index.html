<!DOCTYPE html>
<html>
<head>

<title>Advanced Shooter</title>

<style>

body{
margin:0;
background:black;
color:white;
font-family:Arial;
text-align:center;
}

canvas{
background:#111;
display:block;
margin:auto;
}

</style>

</head>

<body>

<h2>Advanced Shooter</h2>

<p>
WASD Move |
Space Shoot |
Shift Rapid Fire
</p>

<p>
Score: <span id="score">0</span>
Level: <span id="level">1</span>
Health: <span id="health">100</span>
Highscore: <span id="high">0</span>
</p>

<canvas id="game" width="900" height="600"></canvas>

<script>

const canvas = document.getElementById("game");
const c = canvas.getContext("2d");

let score=0;
let level=1;

let highscore=localStorage.highscore||0;
document.getElementById("high").textContent=highscore;

let player={
x:450,
y:500,
size:25,
speed:5,
health:100
};

let bullets=[];
let enemies=[];
let particles=[];
let healthpacks=[];

let keys={};

let lastShot=0;

document.addEventListener(
"keydown",
e=>keys[e.key]=true
);

document.addEventListener(
"keyup",
e=>keys[e.key]=false
);

function shoot(speed){

let now=Date.now();

if(now-lastShot<150)
return;

lastShot=now;

bullets.push({

x:player.x+10,
y:player.y,
dy:-speed,
size:6

});

}

function spawnEnemy(){

enemies.push({

x:Math.random()*880,
y:-20,
speed:1+level*0.5,
size:20,
health:2

});

}

setInterval(spawnEnemy,1500);

function spawnHealth(){

healthpacks.push({

x:Math.random()*880,
y:-20,
size:15

});

}

setInterval(spawnHealth,8000);

function explosion(x,y){

for(let i=0;i<12;i++){

particles.push({

x:x,
y:y,
dx:Math.random()*6-3,
dy:Math.random()*6-3,
life:30

});

}

}

function update(){

if(keys["a"])
player.x-=player.speed;

if(keys["d"])
player.x+=player.speed;

if(keys["w"])
player.y-=player.speed;

if(keys["s"])
player.y+=player.speed;


/* Boundaries */

player.x=Math.max(0,
Math.min(875,player.x));

player.y=Math.max(0,
Math.min(575,player.y));


/* Shooting */

if(keys[" "])
shoot(8);

if(keys["Shift"])
shoot(12);


/* Bullets */

bullets.forEach((b,i)=>{

b.y+=b.dy;

if(b.y<0)
bullets.splice(i,1);

});


/* Enemies */

enemies.forEach((e,ei)=>{

let dx=player.x-e.x;

e.x+=dx*0.02;

e.y+=e.speed;

if(e.y>600){

player.health-=10;

enemies.splice(ei,1);

}

});


/* Collisions */

bullets.forEach((b,bi)=>{

enemies.forEach((e,ei)=>{

let dx=b.x-e.x;

let dy=b.y-e.y;

let d=Math.sqrt(dx*dx+dy*dy);

if(d<20){

e.health--;

bullets.splice(bi,1);

if(e.health<=0){

explosion(e.x,e.y);

score+=10;

enemies.splice(ei,1);

}

}

});

});


/* Healthpacks */

healthpacks.forEach((h,hi)=>{

h.y+=2;

let dx=player.x-h.x;

let dy=player.y-h.y;

let d=Math.sqrt(dx*dx+dy*dy);

if(d<25){

player.health=
Math.min(100,
player.health+20);

healthpacks.splice(hi,1);

}

});


/* Particles */

particles.forEach((p,pi)=>{

p.x+=p.dx;

p.y+=p.dy;

p.life--;

if(p.life<=0)
particles.splice(pi,1);

});


/* Level */

if(score>level*200)
level++;


/* UI */

document.getElementById("score")
textContent=score;

document.getElementById("level")
textContent=level;

document.getElementById("health")
textContent=player.health;


/* Highscore */

if(score>highscore){

highscore=score;

localStorage.highscore=score;

document.getElementById("high")
textContent=score;

}


/* Game Over */

if(player.health<=0){

alert("Game Over");

location.reload();

}

}


function draw(){

c.clearRect(0,0,900,600);


/* Player */

c.fillStyle="cyan";

c.fillRect(
player.x,
player.y,
player.size,
player.size
);


/* Bullets */

c.fillStyle="yellow";

bullets.forEach(b=>{

c.fillRect(
b.x,
b.y,
b.size,
b.size
);

});


/* Enemies */

c.fillStyle="red";

enemies.forEach(e=>{

c.fillRect(
e.x,
e.y,
e.size,
e.size
);

});


/* Healthpacks */

c.fillStyle="green";

healthpacks.forEach(h=>{

c.fillRect(
h.x,
h.y,
h.size,
h.size
);

});


/* Particles */

c.fillStyle="orange";

particles.forEach(p=>{

c.fillRect(
p.x,
p.y,
3,
3
);

});

}


function loop(){

update();
draw();

requestAnimationFrame(loop);

}

loop();

</script>

</body>
</html>

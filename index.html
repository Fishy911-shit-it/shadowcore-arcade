<!DOCTYPE html>
<html>

<head>

<title>Ultimate Tower Defense</title>

<style>

body{
margin:0;
background:#1b1b1b;
color:white;
font-family:Arial;
text-align:center;
}

canvas{
background:#2b2b2b;
display:block;
margin:auto;
}

button{
margin:5px;
padding:10px;
}

</style>

</head>

<body>

<h2>Ultimate Tower Defense</h2>

<div>

Money:
<span id="money">300</span>

Health:
<span id="health">30</span>

Wave:
<span id="wave">1</span>

</div>

<div>

<button onclick="selectTower('gun')">
Gun $50
</button>

<button onclick="selectTower('slow')">
Slow $70
</button>

<button onclick="selectTower('bomb')">
Bomb $100
</button>

</div>

<canvas
id="game"
width="900"
height="500">
</canvas>

<script>

const canvas=
document.getElementById("game");

const c=
canvas.getContext("2d");


let money=300;
let health=30;
let wave=1;

let towers=[];
let enemies=[];
let bullets=[];

let selected="gun";

let spawning=true;



let path=[

{x:0,y:250},
{x:200,y:250},
{x:200,y:100},
{x:500,y:100},
{x:500,y:350},
{x:900,y:350}

];



function selectTower(t){

selected=t;

}



canvas.onclick=function(e){

let rect=
canvas.getBoundingClientRect();

let x=
e.clientX-rect.left;

let y=
e.clientY-rect.top;

let cost={

gun:50,
slow:70,
bomb:100

};

if(money>=cost[selected]){

towers.push({

x:x,
y:y,
type:selected,
cooldown:0

});

money-=cost[selected];

}

};



function spawnEnemy(){

if(!spawning) return;

let types=[

"normal",
"fast",
"tank"

];

let type=
types[Math.floor(Math.random()*3)];

let stats={

normal:{hp:10,speed:1},

fast:{hp:6,speed:2},

tank:{hp:25,speed:0.6}

};

let s=stats[type];

enemies.push({

x:path[0].x,
y:path[0].y,
hp:s.hp+wave*2,
speed:s.speed,
type:type,
step:0

});

}



setInterval(spawnEnemy,1500);



function update(){


/* MOVE ENEMIES */

for(let ei=enemies.length-1;ei>=0;ei--){

let e=enemies[ei];

let target=
path[e.step+1];

if(!target) continue;

let dx=
target.x-e.x;

let dy=
target.y-e.y;

let d=
Math.sqrt(dx*dx+dy*dy);

if(d===0) continue;

e.x+=dx/d*e.speed;

e.y+=dy/d*e.speed;

if(d<5){

e.step++;

if(e.step>=path.length-1){

health--;

enemies.splice(ei,1);

}

}

}



/* TOWERS */

towers.forEach(t=>{

t.cooldown--;

if(t.cooldown>0)
return;



let target=null;

let bestDist=200;

enemies.forEach(e=>{

let dx=e.x-t.x;
let dy=e.y-t.y;

let d=Math.sqrt(dx*dx+dy*dy);

if(d<bestDist){

bestDist=d;
target=e;

}

});



if(!target)
return;



let dx=
target.x-t.x;

let dy=
target.y-t.y;

let d=
Math.sqrt(dx*dx+dy*dy);

if(d===0)
return;



let damage={

gun:2,
slow:1,
bomb:4

};



bullets.push({

x:t.x,
y:t.y,

dx:dx/d*5,
dy:dy/d*5,

type:t.type,

damage:damage[t.type]

});


t.cooldown=40;

});



/* BULLETS */

for(let bi=bullets.length-1;bi>=0;bi--){

let b=bullets[bi];

b.x+=b.dx;

b.y+=b.dy;


for(let ei=enemies.length-1;ei>=0;ei--){

let e=enemies[ei];

let dx=b.x-e.x;

let dy=b.y-e.y;

let d=Math.sqrt(dx*dx+dy*dy);

if(d<15){

if(b.type=="bomb"){

enemies.forEach(e2=>{

let dx=e2.x-b.x;
let dy=e2.y-b.y;

let dist=Math.sqrt(dx*dx+dy*dy);

if(dist<60)
e2.hp-=b.damage;

});

}

else{

e.hp-=b.damage;

}



if(b.type=="slow"){

e.speed*=0.8;

}



bullets.splice(bi,1);



if(e.hp<=0){

money+=10;

enemies.splice(ei,1);

}



break;

}

}

}



/* WAVE SYSTEM */

if(enemies.length===0){

wave++;

}



/* UPDATE UI */

document.getElementById("money")
textContent=money;

document.getElementById("health")
textContent=health;

document.getElementById("wave")
textContent=wave;



if(health<=0){

alert("Game Over");

location.reload();

}


}



function draw(){

c.clearRect(0,0,900,500);



/* PATH */

c.strokeStyle="brown";

c.lineWidth=30;

c.beginPath();

c.moveTo(path[0].x,
path[0].y);

path.forEach(p=>
c.lineTo(p.x,p.y));

c.stroke();



/* TOWERS */

towers.forEach(t=>{

if(t.type=="gun")
c.fillStyle="cyan";

if(t.type=="slow")
c.fillStyle="blue";

if(t.type=="bomb")
c.fillStyle="orange";

c.beginPath();

c.arc(
t.x,
t.y,
10,
0,
6.28);

c.fill();

});



/* ENEMIES */

enemies.forEach(e=>{

if(e.type=="fast")
c.fillStyle="yellow";

else if(e.type=="tank")
c.fillStyle="purple";

else
c.fillStyle="red";

c.beginPath();

c.arc(
e.x,
e.y,
10,
0,
6.28);

c.fill();

});



/* BULLETS */

c.fillStyle="white";

bullets.forEach(b=>{

c.fillRect(
b.x,
b.y,
4,
4);

});


}



function loop(){

update();

draw();

requestAnimationFrame(loop);

}



loop();

</script>

</body>

</html>

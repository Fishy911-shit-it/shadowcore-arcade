<!DOCTYPE html>
<html>

<head>

<title>Mega FPS</title>

<style>

body{
margin:0;
background:black;
color:white;
text-align:center;
font-family:Arial;
overflow:hidden;
}

canvas{
display:block;
margin:auto;
background:black;
}

</style>

</head>

<body>

<h3>MEGA FPS</h3>

Health:
<span id="hp">100</span>

Score:
<span id="score">0</span>

Weapon:
<span id="gun">Pistol</span>

<canvas
id="game"
width="900"
height="500">
</canvas>

<script>

const canvas=
document.getElementById("game");

const c=
canvas.getContext("2d");

let hp=100;
let score=0;


/* PLAYER */

let player={

x:3,
y:3,

angle:0

};


/* WEAPONS */

let weapons={

pistol:{
damage:10,
cooldown:20,
name:"Pistol"
},

rifle:{
damage:5,
cooldown:5,
name:"Rifle"
}

};

let weapon="pistol";
let shootTimer=0;


/* MAP */

let map=[

[1,1,1,1,1,1,1,1,1,1],
[1,0,0,0,0,0,0,0,0,1],
[1,0,1,0,1,0,1,0,0,1],
[1,0,1,0,0,0,1,0,0,1],
[1,0,0,0,1,0,0,0,0,1],
[1,0,0,0,0,0,0,1,0,1],
[1,0,1,0,1,0,0,0,0,1],
[1,0,0,0,0,0,0,0,0,1],
[1,1,1,1,1,1,1,1,1,1]

];


/* ENEMIES */

let enemies=[];

function spawnEnemy(){

enemies.push({

x:Math.random()*8+1,
y:Math.random()*6+1,

hp:40

});

}

setInterval(spawnEnemy,3000);


/* HEALTH PACKS */

let packs=[

{x:6,y:6},
{x:2,y:5}

];


/* CONTROLS */

let keys={};

document.onkeydown=e=>{

keys[e.key]=true;

if(e.key=="1") weapon="pistol";
if(e.key=="2") weapon="rifle";

};

document.onkeyup=e=>keys[e.key]=false;


/* MOUSE LOOK */

canvas.onclick=function(){

canvas.requestPointerLock();

};


document.onmousemove=function(e){

if(document.pointerLockElement===canvas){

player.angle+=e.movementX*0.003;

}

};



/* SHOOT */

document.onclick=function(){

if(shootTimer>0)return;

shootTimer=
weapons[weapon].cooldown;


enemies.forEach((e,i)=>{

let dx=e.x-player.x;
let dy=e.y-player.y;

let angle=Math.atan2(dy,dx);

let diff=Math.abs(angle-player.angle);

if(diff<0.2){

e.hp-=weapons[weapon].damage;

if(e.hp<=0){

score+=100;

enemies.splice(i,1);

}

}

});

};



/* MOVE */

function move(){

let speed=0.05;

let nx=player.x;
let ny=player.y;

if(keys["w"]){

nx+=Math.cos(player.angle)*speed;
ny+=Math.sin(player.angle)*speed;

}

if(keys["s"]){

nx-=Math.cos(player.angle)*speed;
ny-=Math.sin(player.angle)*speed;

}

if(keys["a"]){

nx+=Math.cos(player.angle-1.57)*speed;
ny+=Math.sin(player.angle-1.57)*speed;

}

if(keys["d"]){

nx+=Math.cos(player.angle+1.57)*speed;
ny+=Math.sin(player.angle+1.57)*speed;

}


if(map[Math.floor(ny)]
[Math.floor(nx)]==0){

player.x=nx;
player.y=ny;

}


packs.forEach((p,i)=>{

let dx=player.x-p.x;
let dy=player.y-p.y;

let d=Math.sqrt(dx*dx+dy*dy);

if(d<0.5){

hp=Math.min(100,hp+30);

packs.splice(i,1);

}

});

}



/* RENDER */

function render(){

c.fillStyle="black";
c.fillRect(0,0,900,500);



for(let x=0;x<900;x++){

let rayAngle=
player.angle
-0.5
+(x/900);

let dist=0;

let hit=false;


while(!hit && dist<20){

dist+=0.02;

let rx=
player.x
+Math.cos(rayAngle)*dist;

let ry=
player.y
+Math.sin(rayAngle)*dist;

if(map[
Math.floor(ry)]
[Math.floor(rx)
]==1){

hit=true;

}

}


let height=
500/dist;

let shade=
200/dist;

c.fillStyle=
"rgb("
+shade+","
+shade+","
+shade+")";

c.fillRect(

x,
250-height/2,
1,
height

);

}



/* ENEMIES */

enemies.forEach(e=>{

let dx=e.x-player.x;
let dy=e.y-player.y;

let dist=Math.sqrt(dx*dx+dy*dy);

let angle=
Math.atan2(dy,dx)
-player.angle;

let sx=
450+angle*700;

let size=
200/dist;

c.fillStyle="red";

c.fillRect(

sx-size/2,
250-size/2,
size,
size

);

});


/* CROSSHAIR */

c.fillStyle="white";

c.fillRect(445,250,10,2);
c.fillRect(450,245,2,10);


}



/* AI */

function ai(){

enemies.forEach(e=>{

let dx=
player.x-e.x;

let dy=
player.y-e.y;

let d=
Math.sqrt(dx*dx+dy*dy);

if(d>0.5){

e.x+=dx/d*0.01;
e.y+=dy/d*0.01;

}

if(d<0.7){

hp-=0.1;

}

});

}



/* LOOP */

function loop(){

move();

ai();

render();

shootTimer--;


document.getElementById("hp")
textContent=Math.floor(hp);

document.getElementById("score")
textContent=score;

document.getElementById("gun")
textContent=weapons[weapon].name;


if(hp<=0){

alert("Game Over");

location.reload();

}


requestAnimationFrame(loop);

}


loop();

</script>

</body>

</html>
